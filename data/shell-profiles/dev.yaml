# Shell Profiles - Development Environments
# IDE integrated terminals and language version managers
#
# This file addresses common development environment issues, particularly:
# - GUI IDEs launched from desktop not inheriting shell profiles
# - Language version managers (rbenv, nvm, pyenv, etc.) not being available
# - Environment variables not set in IDE terminals
#
# Related files:
# - core.yaml: OS and Shell basics
# - contexts.yaml: Execution contexts
# - automation.yaml: Automation and isolated environments

# GUI application execution contexts
gui_app_contexts:
  # IDEs and Editors with integrated terminals
  ide_integrated_terminal:
    problem: "GUI apps started from desktop don't inherit shell profile"
    affected_apps:
      - VSCode (code)
      - IntelliJ IDEA
      - PyCharm
      - WebStorm
      - Sublime Text
      - Atom (deprecated)
      - Eclipse
      - NetBeans

    scenarios:
      desktop_launcher:
        description: "App launched from application menu or .desktop file"
        shell_profile_loaded: false
        environment_source: "systemd user session or display manager"
        typical_issues:
          - "rbenv/rvm not in PATH"
          - "nvm not available"
          - "conda not activated"
          - "pyenv missing"
          - "Custom PATH not set"

      terminal_launch:
        description: "App launched from terminal: $ code ."
        shell_profile_loaded: true
        environment_source: "inherits from parent shell"
        typical_issues: []

    solutions:
      vscode:
        # New method (VSCode 1.56+, recommended)
        - "Use terminal.integrated.profiles.linux to define shell profiles"
        - "Set terminal.integrated.defaultProfile.linux to your profile"
        - "Add args: ['--login'] or args: ['-l'] in profile for login shell"
        - "Use terminal.integrated.env.linux for environment variables"
        # Legacy method (deprecated but still works)
        - "(Deprecated) terminal.integrated.shell.linux / shellArgs.linux"

      general:
        - "Launch IDE from terminal instead of desktop"
        - "Modify .desktop file to wrap command with shell"
        - "Use ~/.pam_environment or /etc/environment"
        - "Configure in ~/.config/environment.d/*.conf"
        # Note: Using bash -lc in .desktop may source both .bash_profile and .bashrc

  # Desktop launchers (.desktop files)
  desktop_file_execution:
    location:
      - ~/.local/share/applications/*.desktop
      - /usr/share/applications/*.desktop
      - /usr/local/share/applications/*.desktop

    exec_field:
      description: "Exec= line runs without shell profile"
      example: "Exec=/usr/bin/code %F"
      shell_profile_loaded: false

    workarounds:
      wrapped_command: "Exec=/bin/bash -lc '/usr/bin/code %F'"
      custom_desktop_file: "Copy to ~/.local/share/applications/ and modify"

# Language version managers and environment tools
# Structure: init_command and init_files can be shell-specific for precision
language_version_managers:
  # Ruby
  rbenv:
    init_command:
      bash: 'eval "$(rbenv init - bash)"'
      zsh: 'eval "$(rbenv init - zsh)"'
      fish: 'status --is-interactive; and rbenv init - fish | source'
      generic: 'eval "$(rbenv init -)"'
    init_files:
      bash: [~/.bashrc]
      zsh: [~/.zshrc]
      fish: [~/.config/fish/config.fish]
    shims_location: ~/.rbenv/shims
    path_modification: true
    typical_problem: "ruby command not found in GUI IDE"

  rvm:
    init_command: "source ~/.rvm/scripts/rvm"
    # RVM is function-based; login shell files recommended
    # macOS: .bash_profile, Linux: .bashrc
    init_files:
      bash:
        macos: [~/.bash_profile]
        linux: [~/.bashrc]
      zsh: [~/.zshrc, ~/.zlogin]
    path_modification: true
    function_definitions: true
    typical_problem: "rvm is a function, not available in sub-shells"
    note: "RVM recommends login shell initialization"

  # Node.js
  nvm:
    init_command: "source ~/.nvm/nvm.sh"
    init_files:
      bash: [~/.bashrc]
      zsh: [~/.zshrc]
      # .profile can cause issues in some environments (WSL)
    lazy_load: true
    function_definitions: true
    typical_problem: "nvm command not found, node version not set"

  # Python
  pyenv:
    init_command:
      base: 'eval "$(pyenv init -)"'
      # Add virtualenv-init for auto-activation when entering directories
      virtualenv: 'eval "$(pyenv virtualenv-init -)"'
    init_files:
      bash: [~/.bashrc]
      zsh: [~/.zshrc]
      fish: [~/.config/fish/config.fish]
    shims_location: ~/.pyenv/shims
    path_modification: true

  conda:
    init_command:
      bash: 'eval "$(conda shell.bash hook)"'
      zsh: 'eval "$(conda shell.zsh hook)"'
      fish: 'eval conda "shell.fish" "hook" | source'
    init_files:
      bash: [~/.bashrc]
      zsh: [~/.zshrc]
      fish: [~/.config/fish/config.fish]
    path_modification: true
    environment_activation: true
    typical_problem: "conda not available, base environment not activated"

  # Java
  jenv:
    init_command:
      bash: 'eval "$(jenv init - bash)"'
      zsh: 'eval "$(jenv init - zsh)"'
      generic: 'eval "$(jenv init -)"'
    init_files:
      bash: [~/.bashrc]
      zsh: [~/.zshrc]
    shims_location: ~/.jenv/shims
    path_modification: true

  sdkman:
    init_command: "source ~/.sdkman/bin/sdkman-init.sh"
    init_files:
      bash: [~/.bashrc]
      zsh: [~/.zshrc]
    path_modification: true

  # Go
  gvm:
    init_command: "source ~/.gvm/scripts/gvm"
    init_files:
      bash: [~/.bashrc, ~/.bash_profile]
      zsh: [~/.zshrc]
    path_modification: true

  # Rust
  rustup:
    init_command: "source ~/.cargo/env"
    init_files:
      bash: [~/.bashrc, ~/.bash_profile]
      zsh: [~/.zshrc, ~/.zprofile]
    path_modification: true
    env_file: ~/.cargo/env
